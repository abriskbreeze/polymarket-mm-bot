---
session: polymarket-mm-bot
date: 2026-01-21
status: complete
outcome: SUCCEEDED
---

goal: Fixed TUI not exiting when bot stops (Ctrl+C left terminal stuck)
now: Run bot overnight with working TUI exit behavior
test: source venv/bin/activate && pytest tests/test_tui.py -v --timeout=60

done_this_session:
  - task: Diagnosed root cause - market_maker.run() replaced TUIBotRunner signal handlers
    files: [src/strategy/market_maker.py, src/tui/runner.py]
  - task: Added install_signals parameter to market_maker.run()
    files: [src/strategy/market_maker.py]
  - task: TUIBotRunner now passes install_signals=False to own signals exclusively
    files: [src/tui/runner.py]
  - task: Removed redundant manual renderer.stop() from signal handler
    files: [src/tui/runner.py]

blockers: []

questions: []

decisions:
  - install_signals_param: Added bool param rather than removing signal handling entirely - standalone market_maker still needs it

findings:
  - signal_handler_replacement: Python asyncio signal handlers replace previous handlers for same signal
  - race_condition_misdiagnosis: Initial plan blamed renderer.stop() race condition, but real issue was signal handler ownership

worked:
  - Adding install_signals=False to skip handler installation in TUI context
  - TUIBotRunner owning signal handling exclusively when running with TUI

failed:
  - Initial fix (removing renderer.stop()) didn't solve the issue - wrong root cause

next:
  - Run bot overnight with working TUI
  - Monitor for any other shutdown edge cases
  - Consider adding graceful shutdown timeout if cleanup hangs

files:
  created: []
  modified:
    - src/tui/runner.py
    - src/strategy/market_maker.py
